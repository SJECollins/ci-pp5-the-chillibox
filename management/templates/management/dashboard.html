{% extends 'base.html' %}
{% load static %}

{% block title %}
Dashboard
{% endblock %}

{% block content %}
<section class="row">
    <!-- Management landing template - products -->
    <div class="text-center">
        <h1 class="headings mb-2">Products</h1>
        <div class="d-flex flex-row justify-content-center">
            <div class="border border-2 p-1">
                <a class="chilli-link" href="{% url 'management:user_reviews' %}">Reviews</a>
            </div>
            <div class="border border-2 p-1">
                <a class="chilli-link" href="{% url 'management:recipes' %}">Recipes</a>
            </div>
        </div>
    </div>
    <div class="text-center my-3">
        <div>
            <a class="chilli-btn" href="{% url 'management:add_product' %}">Add New Product</a>
        </div>
    </div>
    <!-- Group added products by category -->
    {% regroup products by category as products_by_category %}
    {% for category in products_by_category %}
    <div class="col-12 col-lg-6">
        <!-- Category heading -->
        <h2 class="headings">{{ category.grouper}}</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Thumbnail</th>
                    <th>Edit</th>
                    <th>Delete</th>
                    <th>Add Variant</th>
                    <th>
                        <button role="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-{{ category.grouper }}" aria-expanded="false"
                            aria-controls="collapse-{{ category.grouper }}">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                    </th>
                </tr>
            </thead>
            <!-- Product details -->
            {% for product in category.list %}
            <tbody class="collapse" id="collapse-{{ category.grouper }}">
                <tr>
                    <td><a class="chilli-link" href="{% url 'products:product' product.slug %}">
                        {{ product.name }}</a></td>
                    <td>{% if product.thumbnail %}Yes{% else %}No{% endif %}</td>
                    <td>
                        <a class="chilli-btn" href="{% url 'management:edit_product' product.id %}">Edit</a>
                    </td>
                    <td>
                        <a class="chilli-btn chilli-dngr"
                            href="{% url 'management:delete_product' product.id %}">Delete</a>
                    </td>
                    <td>
                        <a class="chilli-btn" href="{% url 'management:add_variant' product.slug %}">Add</a>
                    </td>
                </tr>
                <thead>
                    <tr>
                        <th>Size</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Update Stock</th>
                        <th>Edit</th>
                        <th>Delete</th>
                        <th>
                            <button role="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ product.id }}"
                                aria-expanded="false" aria-controls="collapse-{{ product.id }}">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </th>
                    </tr>
                </thead>
            <tbody class="collapse" id="collapse-{{ product.id }}">
                <!-- Product variants -->
                {% for variant in product.variants.all %}
                <tr>
                    <td>{{ variant.size }}</td>
                    <td>{{ variant.price }}</td>
                    <td>{{ variant.current_stock }}</td>
                    <td><a class="chilli-btn" data-hx-get="{% url 'management:update_stock' variant.pk %}"
                            data-hx-target="#dialog">Update</a></td>
                    <td>
                        <a class="chilli-btn" href="{% url 'management:edit_variant' variant.id %}">Edit</a>
                    </td>
                    <td>
                        <a class="chilli-btn chilli-dngr"
                            href="{% url 'management:delete_variant' variant.id %}">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
</section>

{% endblock %}
<!-- Script for modal for stock update -->
{% block additional_script %}
<script src="{% static 'js/modal.js' %}"></script>
{% endblock %}